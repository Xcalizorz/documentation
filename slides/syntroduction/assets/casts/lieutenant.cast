{"version": 2, "width": 190, "height": 26, "timestamp": 1594729624, "env": {"SHELL": "/bin/bash", "TERM": "xterm-256color"}, "title": "Project Syn - Lieutenant Demo"}
[0.010384, "o", "\u001b[H\u001b[2J\u001b[3J"]
[0.014814, "o", "$ \u001b[1;37m++ Welcome to Project Syn - Lieutenant Demo\u001b[0m"]
[0.014961, "o", "\r\n"]
[2.021389, "o", "$ \u001b[1;37m++ Lets check if the Lieutenant API is healthy and reachable\u001b[0m\r\n"]
[2.026897, "o", "$ \u001b[1;37mecho http://lieutenant.${INGRESS_IP}.nip.io/healthz\u001b[0m\r\n"]
[2.027051, "o", "http://lieutenant.172.23.0.2.nip.io/healthz\r\n"]
[2.032918, "o", "$ \u001b[1;37mcurl http://lieutenant.${INGRESS_IP}.nip.io/healthz\u001b[0m\r\n"]
[2.040159, "o", "ok\r\n"]
[3.058715, "o", "$ "]
[3.05913, "o", "\u001b[1;37m++ The API responds with \"ok\", all is fine for the next steps\u001b[0m\r\n"]
[8.064521, "o", "\u001b[H\u001b[2J\u001b[3J"]
[8.081425, "o", "$ \u001b[1;37m++ Now we register a new tenant in the API\u001b[0m"]
[8.081912, "o", "\r\n"]
[10.101713, "o", "$ "]
[10.102173, "o", "\u001b[1;37mTENANT_ID=$(curl -s -H \"$LIEUTENANT_AUTH\" -H \"Content-Type: application/json\" -X POST --data \"{\\\"displayName\\\":\\\"My first Tenant\\\",\\\"gitRepo\\\":{\\\"url\\\":\\\"ssh://git@${GITLAB_ENDPOINT}/${GITLAB_USERNAME}/mytenant.git\\\"}}\" \"http://${LIEUTENANT_URL}/tenants\" | jq -r \".id\")\u001b[0m\r\n"]
[10.616425, "o", "$ \u001b[1;37mecho $TENANT_ID\u001b[0m"]
[10.616629, "o", "\r\nt-small-bird-2905\r\n"]
[10.626805, "o", "$ \u001b[1;37mecho https://${GITLAB_ENDPOINT}/${GITLAB_USERNAME}/mytenant\u001b[0m"]
[10.627045, "o", "\r\nhttps://git.vshn.net/tobias.brunner/mytenant\r\n"]
[10.633634, "o", "$ \u001b[1;37m++ This created a Git repository on the above URL for the tenant configuration\u001b[0m"]
[10.633788, "o", "\r\n"]
[13.65217, "o", "$ \u001b[1;37m++ Lets retrieve the tenants, via API and directly on the cluster\u001b[0m\r\n"]
[15.671931, "o", "$ \u001b[1;37mcurl -H \"$LIEUTENANT_AUTH\" \"http://${LIEUTENANT_URL}/tenants\"\u001b[0m"]
[15.672465, "o", "\r\n"]
[16.154866, "o", "[{\"id\":\"t-small-bird-2905\",\"displayName\":\"My first Tenant\",\"gitRepo\":{\"type\":\"auto\",\"url\":\"ssh://git@git.vshn.net/tobias.brunner/mytenant.git\"}}]\r\n"]
[16.173277, "o", "$ \u001b[1;37mkubectl -n lieutenant get tenant\u001b[0m\r\n"]
[16.27125, "o", "NAME                DISPLAY NAME      AGE\r\nt-small-bird-2905   My first Tenant   5s\r\n"]
[18.29155, "o", "$ \u001b[1;37m++ And the Git repo object\u001b[0m\r\n"]
[18.30814, "o", "$ \u001b[1;37mkubectl -n lieutenant get gitrepo\u001b[0m\r\n"]
[18.416392, "o", "NAME                DISPLAY NAME      REPO NAME   PHASE     AGE\r\nt-small-bird-2905   My first Tenant   mytenant    created   7s\r\n"]
[23.422741, "o", "\u001b[H\u001b[2J\u001b[3J"]
[23.440002, "o", "$ \u001b[1;37m++ Now we register a cluster in Lieutenant and assign it to the new tenant created before\u001b[0m"]
[23.440172, "o", "\r\n"]
[25.46071, "o", "$ "]
[25.461081, "o", "\u001b[1;37mCLUSTER_ID=$(curl -s -H \"$LIEUTENANT_AUTH\" -H \"Content-Type: application/json\" -X POST --data \"{ \\\"tenant\\\": \\\"${TENANT_ID}\\\", \\\"displayName\\\": \\\"My first Project Syn cluster\\\", \\\"facts\\\": { \\\"cloud\\\": \\\"local\\\", \\\"distribution\\\": \\\"k3s\\\", \\\"region\\\": \\\"local\\\" }, \\\"gitRepo\\\": { \\\"url\\\": \\\"ssh://git@${GITLAB_ENDPOINT}/${GITLAB_USERNAME}/cluster-gitops1.git\\\" } }\" \"http://${LIEUTENANT_URL}/clusters\" | jq -r \".id\")\u001b[0m\r\n"]
[25.971263, "o", "$ \u001b[1;37mecho $CLUSTER_ID\u001b[0m\r\nc-old-tree-9259\r\n"]
[25.984001, "o", "$ "]
[25.984226, "o", "\u001b[1;37mecho https://${GITLAB_ENDPOINT}/${GITLAB_USERNAME}/cluster-gitops1\u001b[0m\r\nhttps://git.vshn.net/tobias.brunner/cluster-gitops1\r\n"]
[25.993006, "o", "$ \u001b[1;37m++ Another Git repo got created on the above URL for the cluster catalog\u001b[0m\r\n"]
[30.995818, "o", "\u001b[H\u001b[2J\u001b[3J"]
[31.002846, "o", "$ \u001b[1;37m++ Lets check the object on the API and on the cluster\u001b[0m\r\n"]
[33.021419, "o", "$ \u001b[1;37mcurl -H \"$LIEUTENANT_AUTH\" \"http://${LIEUTENANT_URL}/clusters\"\u001b[0m"]
[33.021797, "o", "\r\n"]
[33.507131, "o", "[{\"id\":\"c-old-tree-9259\",\"tenant\":\"t-small-bird-2905\",\"displayName\":\"My first Project Syn cluster\",\"facts\":{\"cloud\":\"local\",\"distribution\":\"k3s\",\"lieutenant-instance\":\"lieutenant\",\"region\":\"local\"},\"gitRepo\":{\"hostKeys\":\"git.vshn.net ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnE1dMkh+3uHWck+cTvQqeNUW0lj1uVcIC9JX2Tg6gmkKCYA73+o+I7vo4g6nPtSOAfITvYdHJLzwE9GwlSFsXHMR9q0ErWl2wC+w6FawLMz9//5XqiBi2qq/8WnWp3ecY16jDoGRW4eymT+USFHKJVi696XBy3WE/0BBapPZ58WPqkKN6A27qkIK6FehI80f+zN4ZqikdwWuCFs35fsimcmLnWqWPm8zbOkgCiB+ov4O/xmRNHwJWCk/qzU6X/M9YtMXzAa5mjwDvcHSAizFD3a3Fv68G1VsmRZ0THLrRKM/WOxrWNZoimSNgyjTzoCwiKeckvL5+hpNcNSW+eBPt\\ngit.vshn.net ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIO9EkPcVdsz/oVTI2VJkBlq8Mv/dg3rhcbgzAEKyiwUG\",\"type\":\"auto\",\"url\":\"ssh://git@git.vshn.net/tobias.brunner/cluster-gitops1.git\"}}]\r\n"]
[33.525929, "o", "$ \u001b[1;37mkubectl -n lieutenant get cluster\u001b[0m\r\n"]
[33.622454, "o", "NAME              DISPLAY NAME                   TENANT              AGE\r\nc-old-tree-9259   My first Project Syn cluster   t-small-bird-2905   8s\r\n"]
[33.628959, "o", "$ \u001b[1;37mkubectl -n lieutenant get gitrepo\u001b[0m\r\n"]
[33.691448, "o", "NAME                DISPLAY NAME                   REPO NAME         PHASE     AGE\r\nt-small-bird-2905   My first Tenant                mytenant          created   23s\r\nc-old-tree-9259     My first Project Syn cluster   cluster-gitops1   created   8s"]
[33.691506, "o", "\r\n"]
[36.71159, "o", "$ \u001b[1;37m++ Thats it, Lieutenant now has a tenant and a cluster registered. Thanks for watching.\u001b[0m"]
[36.712102, "o", "\r\n"]
